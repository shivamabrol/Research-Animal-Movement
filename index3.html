<!DOCTYPE html>
<meta charset="utf-8" />
<style>
  svg {
    font: 10px sans-serif;
  }

  .area {
    fill: #b4b4b4;
    opacity: 0.8;
    clip-path: url(#clip);
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .brush .extent {
    stroke: black;
    fill: white;
    fill-opacity: 0.6;
    shape-rendering: crispEdges;
  }
</style>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.2.0/d3.min.js"></script>
  <script>
    let data1;
    d3.csv("../data/Dead-Reackon-Sample-1.csv").then(function (data) {
      data1 = data;
      const margin = { top: 10, right: 10, bottom: 100, left: 40 };
      const margin2 = { top: 430, right: 10, bottom: 20, left: 40 };
      const width = 960 - margin.left - margin.right;
      const height = 500 - margin.top - margin.bottom;
      const height2 = 500 - margin2.top - margin2.bottom;

      const parseDate = d3.timeParse("%Y");
      //%b

      const x = d3.scaleTime().range([0, width]);
      const x2 = d3.scaleTime().range([0, width]);
      const y = d3.scaleLinear().range([height, 0]);
      const y2 = d3.scaleLinear().range([height2, 0]);

      const xAxis = d3.axisBottom(x);
      const xAxis2 = d3.axisBottom(x2);
      const yAxis = d3.axisLeft(y);

      const brush = d3
        .brushX()
        .extent([
          [0, 0],
          [width, height2],
        ])
        .on("brush end", brushed);

      // create the area
      const area = d3
        .area()
        .x(function (d) {
          return x(new Date(d["date_string"]));
        })
        .y0(height)
        .y1(function (d) {
          return y(d["trajectory-finder"]);
        });

      // create the area
      const area2 = d3
        .area()
        .x(function (d) {
          return x2(new Date(d["date_string"]));
        })
        .y0(height)
        .y1(function (d) {
          return y2(d["trajectory-finder"]);
        });

      // var lineV = d3.svg.line()
      //                   .interpolate("monotone")
      //                   .x(function(d) { return x(d.date); })
      //                   .y(function(d) { return yV(d.y)});

      const svg = d3
        .select("body")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);

      svg
        .append("defs")
        .append("clipPath")
        .attr("id", "clip")
        .append("rect")
        .attr("width", width)
        .attr("height", height);

      const focus = svg
        .append("g")
        .attr("class", "focus")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      const context = svg
        .append("g")
        .attr("class", "context")
        .attr(
          "transform",
          "translate(" + margin2.left + "," + margin2.top + ")"
        );

      console.log(data);
      // Do something with the data here

      x.domain([new Date(2022, 6, 1), new Date(2022, 10, 1)]);
      y.domain([0, 100]);
      x2.domain(x.domain());
      y2.domain(y.domain());

      focus.append("path").attr("class", "area").attr("d", area(data));

      focus
        .append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(0,${height})`)
        .call(xAxis);

      focus.append("g").attr("class", "y axis").call(yAxis);

      context.append("path").attr("class", "area").attr("d", area2(data));

      context
        .append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(0,${height2})`)
        .call(xAxis2);

      context
        .append("g")
        .attr("class", "x brush")
        .call(brush)
        .selectAll("rect")
        .attr("y", -6)
        .attr("height", height2 + 7);

      function brushed(event) {
        if (event.selection) {
          const [x0, x1] = event.selection.map(x2.invert);
          x.domain([x0, x1]);
          focus.select(".area").attr("d", area(data1));
          focus.select(".x.axis").call(xAxis);
        }
      }
    });
  </script>
</body>
